name: Build & Distribute to Firebase

on:
  push:
    branches: [main]

jobs:
  build:
    name: ${{ github.ref_name }}
    runs-on: macos-latest

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v3

      - name: ğŸŸ¢ Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: ğŸ“¦ Install npm dependencies
        run: npm install 

      - name: Make build script executable
        run: |
            chmod +x .github/scripts/build-android.sh
            chmod +x .github/scripts/package-app-android.sh
            chmod +x .github/scripts/upload-firebase-android.sh  

      - name: ğŸ› ï¸ Build Android APK (Release)
        run: .github/scripts/build-android.sh

      - name: Package .apk
        run: .github/scripts/package-app-android.sh    

      - name: ğŸ“¤ Upload Android APK to Firebase
        run: .github/scripts/upload-firebase-android.sh
        env:
          ANDROID_APP_ID: ${{ secrets.ANDROID_APP_ID }}
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
